coronation_dynasty_blessing = {
	icon = public

	is_valid = {
		is_current_phase_active = yes
		exists = scope:host.dynasty
		any_attending_character = {
			NOR = {
				this = scope:host
				this = scope:activity.special_guest:coronation_target
			}
			is_physically_able_ai_adult = yes
			location = scope:province
			dynasty ?= { dynasty_prestige_level > scope:host.dynasty.dynasty_prestige_level }
		}
	}

	weight = {
		value = 1
		if = {
			limit = {
				scope:activity = {
					has_activity_option = {
						category = coronation_option_pomp
						option = coronation_pomp_grandiose
					}
				}
			}
			add = 0.5
		}
	}

	effect = {
		scope:host = {
			save_scope_as = root_scope
		}

		random_attending_character = {
			limit = {
				NOR = {
					this = scope:host
					this = scope:activity.special_guest:coronation_target
				}
				is_physically_able_ai_adult = yes
				location = scope:province
				dynasty ?= { dynasty_prestige_level > scope:host.dynasty.dynasty_prestige_level }
			}
			save_scope_as = first
		}

		add_activity_log_entry = {
			key = dynasty_blessing
			tags = { pulse_action }
			character = scope:first

			scope:host.dynasty = {
				add_dynasty_prestige = medium_dynasty_prestige_gain
			}
			scope:first = {
				add_opinion = {
					modifier = impressed_opinion
					target = scope:host
					opinion = 10
				}
			}
		}
	}
}

coronation_gossip_with_guests = {
	icon = intrigue

	is_valid = {
		is_current_phase_active = yes
		has_current_phase = coronation_phase_banquet
		any_attending_character = {
			is_physically_able_adult = yes
			OR = {
				is_ai = no
				this = scope:host
			}
			location = scope:province
			has_lifestyle = intrigue_lifestyle
		}
	}

	weight = {
		value = 1
		if = {
			limit = {
				any_attending_character = {
					is_physically_able_adult = yes
					OR = {
						is_ai = no
						this = scope:host
					}
					location = scope:province
					has_lifestyle = intrigue_lifestyle
					OR = {
						this = scope:host
						this = scope:activity.special_guest:coronation_target
					}
				}
			}
			add = 1
		}
	}

	effect = {
		scope:host = {
			save_scope_as = root_scope
		}

		random_attending_character = {
			limit = {
				is_physically_able_adult = yes
				OR = {
					is_ai = no
					this = scope:host
				}
				location = scope:province
				has_lifestyle = intrigue_lifestyle
				OR = {
					this = scope:host
					this = scope:activity.special_guest:coronation_target
				}
			}
			alternative_limit = {
				is_physically_able_adult = yes
				OR = {
					is_ai = no
					this = scope:host
				}
				location = scope:province
				has_lifestyle = intrigue_lifestyle
			}
			save_scope_as = first
		}

		add_activity_log_entry = {
			key = gossip_with_guests
			tags = { pulse_action }
			character = scope:first

			scope:first = {
				add_intrigue_lifestyle_xp = miniscule_lifestyle_xp
			}
		}
	}
}

coronation_contact_network = {
	icon = courtly

	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			is_physically_able_adult = yes
			OR = {
				is_ai = no
				this = scope:host
			}
			location = scope:province
			has_lifestyle = diplomacy_lifestyle
		}
	}

	weight = {
		value = 1
		if = {
			limit = {
				any_attending_character = {
					is_physically_able_adult = yes
					OR = {
						is_ai = no
						this = scope:host
					}
					location = scope:province
					has_lifestyle = diplomacy_lifestyle
					OR = {
						this = scope:host
						this = scope:activity.special_guest:coronation_target
					}
				}
			}
			add = 1
		}
	}

	effect = {
		scope:host = {
			save_scope_as = root_scope
		}

		random_attending_character = {
			limit = {
				is_physically_able_adult = yes
				OR = {
					is_ai = no
					this = scope:host
				}
				location = scope:province
				has_lifestyle = diplomacy_lifestyle
				OR = {
					this = scope:host
					this = scope:activity.special_guest:coronation_target
				}
			}
			alternative_limit = {
				is_physically_able_adult = yes
				OR = {
					is_ai = no
					this = scope:host
				}
				location = scope:province
				has_lifestyle = diplomacy_lifestyle
			}
			save_scope_as = first
		}

		add_activity_log_entry = {
			key = contact_network
			tags = { pulse_action }
			character = scope:first

			scope:first = {
				add_diplomacy_lifestyle_xp = miniscule_lifestyle_xp
			}
		}
	}
}

coronation_admired_venue = {
	icon = public

	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			NOR = {
				this = scope:host
				this = scope:activity.special_guest:coronation_target
			}
			is_physically_able_ai_adult = yes
			location = scope:province
			has_activity_intent = reduce_stress_intent
		}
	}

	weight = {
		value = 1
		if = {
			limit = {
				scope:activity = {
					has_activity_option = {
						category = coronation_option_pomp
						option = coronation_pomp_grandiose
					}
				}
			}
			add = 2
		}
		if = {
			limit = {
				scope:activity = {
					has_activity_option = {
						category = coronation_option_pomp
						option = coronation_pomp_impressive
					}
				}
			}
			add = 1.5
		}
		if = {
			limit = {
				scope:activity = {
					has_activity_option = {
						category = coronation_option_pomp
						option = coronation_pomp_appropriate
					}
				}
			}
			add = 1.0
		}
		if = {
			limit = {
				scope:activity = {
					has_activity_option = {
						category = coronation_option_pomp
						option = coronation_pomp_humble
					}
				}
			}
			add = 0.5
		}
	}

	effect = {
		scope:host = {
			save_scope_as = root_scope
		}

		random_attending_character = {
			limit = {
				NOR = {
					this = scope:host
					this = scope:activity.special_guest:coronation_target
				}
				is_physically_able_ai_adult = yes
				location = scope:province
				has_activity_intent = reduce_stress_intent
			}
			save_scope_as = first
		}

		add_activity_log_entry = {
			key = admired_venue
			tags = { pulse_action }
			character = scope:first

			scope:first = {
				stress_impact = {
					base = minor_stress_impact_loss
				}
			}
		}
	}
}

coronation_knight_praised = {
	icon = martial

	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			is_physically_able_ai_adult = yes
			location = scope:province
			is_acclaimed = yes
			liege ?= {
				OR = {
					is_ai = no
					this = scope:host
				}
			}
			accolade = { is_accolade_active = yes }
		}
	}

	weight = {
		value = 1
	}

	effect = {
		scope:host = {
			save_scope_as = root_scope
		}

		random_attending_character = {
			limit = {
				is_physically_able_ai_adult = yes
				location = scope:province
				is_acclaimed = yes
				liege ?= {
					OR = {
						is_ai = no
						this = scope:host
					}
				}
				accolade = { is_accolade_active = yes }
			}
			save_scope_as = first
			set_variable = {
				name = court_6040_best_looking_var
				days = 2
			}
		}

		add_activity_log_entry = {
			key = knight_praised
			tags = { pulse_action }
			character = scope:first

			scope:first.accolade = {
				add_glory = minor_glory_gain
			}
		}
	}
}

coronation_seductive_exchange = {
	icon = intrigue

	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			has_activity_intent = woo_attendee_intent
			is_physically_able_ai_adult = yes
			location = scope:province
			intent_target = {
				is_physically_able_ai_adult = yes
				location = scope:province
				is_ai = yes
			}
		}
	}

	weight = {
		value = 0.3
		if = {
			limit = {
				any_attending_character = {
					has_activity_intent = woo_attendee_intent
					is_physically_able_ai_adult = yes
					location = scope:province
					is_ai = no
					intent_target = {
						is_physically_able_ai_adult = yes
						location = scope:province
						is_ai = yes
					}
				}
			}
			add = 0.2
		}
	}

	effect = {
		scope:host = {
			save_scope_as = root_scope
		}

		random_attending_character = {
			limit = {
				has_activity_intent = woo_attendee_intent
				is_physically_able_ai_adult = yes
				location = scope:province
				intent_target = {
					is_physically_able_ai_adult = yes
					location = scope:province
					is_ai = yes
				}
			}
			save_scope_as = first
		}
		scope:first.intent_target = { save_scope_as = second }

		add_activity_log_entry = {
			key = seductive_exchange
			tags = { pulse_action }
			character = scope:first
			target = scope:second

			scope:first = {
				progress_towards_lover_effect = {
					CHARACTER = scope:second
					OPINION = default_lover_opinion
					REASON = lover_wedding_seductive_exchange
				}
			}
		}
	}
}

coronation_poetry_performance = {
	icon = public

	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			OR = {
				has_trait = poet
				AND = {
					has_court_position = court_poet_court_position
					aptitude = {
						court_position = court_poet_court_position
						value >= 3
					}
					court_owner = scope:host
				}
			}
			is_physically_able_ai_adult = yes
			location = scope:province
		}
	}

	weight = {
		value = 1
		if = {
			limit = {
				scope:activity = {
					has_activity_option = {
						category = wedding_option_entertainment
						option = wedding_entertainment_good
					}
				}
			}
			add = 0.5
		}
		if = {
			limit = {
				scope:host = { has_trait = poet }
			}
			add = 0.5
		}
	}

	effect = {
		scope:host = {
			save_scope_as = root_scope
		}
		if = {
			limit = {
				scope:host = {
					has_trait = poet
					is_physically_able_ai_adult = yes
					location = scope:province
				}
			}
			scope:host = { save_scope_as = first }
		}
		else = {
			random_attending_character = {
				limit = {
					OR = {
						has_trait = poet
						AND = {
							has_court_position = court_poet_court_position
							aptitude = {
								court_position = court_poet_court_position
								value >= 3
							}
							court_owner = scope:host
						}
					}
					is_physically_able_ai_adult = yes
					location = scope:province
				}
				save_scope_as = first
			}
		}

		add_activity_log_entry = {
			key = poetry_performance
			tags = { pulse_action }
			character = scope:first

			scope:first = {
				add_prestige = minor_prestige_gain
			}
			if = {
				limit = {
					NOT = { scope:first = scope:host }
				}
				scope:host = {
					add_prestige = minor_prestige_gain
				}
			}
		}
	}
}

coronation_music_performance = {
	icon = public

	is_valid = {
		is_current_phase_active = yes
		any_attending_character = {
			NOR = {
				this = scope:host
				this = scope:activity.special_guest:coronation_target
			}
			is_physically_able_ai_adult = yes
			location = scope:province
			has_court_position = court_musician_court_position
			aptitude = {
				court_position = court_musician_court_position
				value >= 3
			}
			court_owner = scope:host
		}
	}

	weight = {
		value = 1
		if = {
			limit = {
				scope:activity = {
					has_activity_option = {
						category = wedding_option_entertainment
						option = wedding_entertainment_good
					}
				}
			}
			add = 1
		}
	}

	effect = {
		scope:host = {
			save_scope_as = root_scope
		}

		random_attending_character = {
			limit = {
				NOR = {
					this = scope:host
					this = scope:activity.special_guest:coronation_target
				}
				is_physically_able_ai_adult = yes
				location = scope:province
				has_court_position = court_musician_court_position
				aptitude = {
					court_position = court_musician_court_position
					value >= 3
				}
				court_owner = scope:host
			}
			save_scope_as = first
		}

		add_activity_log_entry = {
			key = music_performance
			tags = { pulse_action }
			character = scope:first

			scope:first = {
				add_prestige = minor_prestige_gain
			}
			scope:host = {
				add_prestige = minor_prestige_gain
			}
		}
	}
}
